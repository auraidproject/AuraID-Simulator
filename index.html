<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AuraID Simulator</title>
    <style>
        :root { --bg: #0f0f0f; --card: #1a1a1a; --primary: #007aff; --accent: #00ff88; --text: #ffffff; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        
        /* Mobile Wrapper */
        .phone-container { width: 100%; max-width: 375px; height: 100%; max-height: 667px; background: var(--card); border-radius: 30px; position: relative; display: flex; flex-direction: column; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid #333; }
        
        .header { padding: 40px 20px 20px; text-align: center; font-weight: bold; font-size: 1.2em; letter-spacing: 1px; color: var(--primary); }
        .aura-circle { width: 120px; height: 120px; border-radius: 50%; border: 2px solid var(--primary); margin: 20px auto; display: flex; justify-content: center; align-items: center; position: relative; }
        .aura-pulse { position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 2px solid var(--primary); animation: pulse 2s infinite; opacity: 0; }
        
        @keyframes pulse { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(1.5); opacity: 0; } }

        .content { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; gap: 15px; }
        label { font-size: 0.8em; color: #888; margin-bottom: -10px; }
        input, select { background: #252525; border: 1px solid #444; color: white; padding: 12px; border-radius: 10px; font-size: 1em; }
        
        .btn-ping { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 15px; font-weight: bold; font-size: 1em; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn-ping:active { transform: scale(0.95); opacity: 0.8; }

        #status-box { margin-top: 20px; padding: 15px; border-radius: 10px; background: #222; text-align: center; font-size: 0.9em; min-height: 40px; }
        .match-active { background: var(--accent) !important; color: #000 !important; font-weight: bold; animation: flash 1s infinite; }
        
        @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .user-info { font-size: 0.7em; color: #555; text-align: center; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="phone-container">
    <div class="header">AuraID</div>
    
    <div class="aura-circle">
        <div class="aura-pulse" id="pulse"></div>
        <span id="id-display">ID...</span>
    </div>

    <div class="content">
        <label>MOJA AKTIVNOST</label>
        <select id="hexPrefix">
            <option value="01">Nudim (01)</option>
            <option value="02">Tražim (02)</option>
        </select>
        
        <label>KATEGORIJA</label>
        <input type="text" id="hexCat" value="A1" maxlength="2">
        
        <label>LOKACIJA</label>
        <input type="text" id="lokacija" value="Menza_Sava">
        
        <button class="btn-ping" onclick="startAura()">AKTIVIRAJ AURU</button>
        
        <div id="status-box">Sustav spreman...</div>
        <div class="user-info" id="user-details"></div>
    </div>
</div>

<script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyBEZFrM-oBmhVWQEUNWob0APuURFP-f4jYeAUgkcdOJm8ucGT1-8_VFpnVlXqZr5madQ/exec"; // <--- OVDJE STAVI SVOJ URL

    // 1. GENERIRANJE ILI PREUZIMANJE UNIKATNOG ID-A
    let userId = localStorage.getItem('aura_id');
    if (!userId) {
        userId = 'Aura-' + Math.floor(1000 + Math.random() * 9000);
        localStorage.setItem('aura_id', userId);
    }
    document.getElementById('id-display').innerText = userId;
    document.getElementById('user-details').innerText = "Vaš stalni ID: " + userId;

    let isScanning = false;

    async function startAura() {
        isScanning = true;
        document.getElementById('pulse').style.display = 'block';
        document.getElementById('status-box').innerText = "Aura je aktivna. Osluškujem...";
        
        // Prvi ping
        sendPing();
        
        // Ponavljaj ping svakih 7 sekundi (da ne zagušimo tablicu)
        setInterval(() => {
            if(isScanning) sendPing();
        }, 7000);
    }

    async function sendPing() {
        const payload = {
            id: userId,
            hex: document.getElementById('hexPrefix').value + document.getElementById('hexCat').value,
            hash: Math.floor(Math.random() * 9000) + 1000,
            lokacija: document.getElementById('lokacija').value
        };

        try {
            const response = await fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(payload)
            });
            
            // Budući da je no-cors, ne možemo čitati odgovor direktno,
            // ali možemo dodati vizualni signal da je ping poslan
            console.log("Ping poslan...");
        } catch (e) {
            console.error("Greška:", e);
        }
    }

    // Ovdje ćemo u idućem koraku dodati funkciju za provjeru MATCH-a iz tablice
</script>

</body>
</html>
